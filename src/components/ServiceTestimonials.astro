---
interface Testimonial {
  quote: string;
  author: {
    name: string;
    title?: string;
    company?: string;
    image?: string;
    handle?: string;
  };
  rating?: number;
  project?: string;
  platform?: 'linkedin' | 'x';
  url?: string;
}

interface Props {
  title?: string;
  subtitle?: string;
  testimonials: Testimonial[];
  layout?: 'grid' | 'carousel' | 'single' | 'social';
  showRatings?: boolean;
}

import LinkedInIcon from '@components/icons/linkedin-icon.astro';
import XIcon from '@components/icons/x-icon.astro';

const {
  title = "What Clients Say",
  subtitle,
  testimonials,
  layout = 'grid',
  showRatings = true
} = Astro.props;

// Generate star rating display
function generateStars(rating: number = 5) {
  return Array.from({ length: 5 }, (_, i) => i < rating ? '★' : '☆').join('');
}

---

<section class="service-testimonials">
  <div class="service-testimonials__container">
    {(title || subtitle) && (
      <div class="service-testimonials__header">
        {subtitle && (
          <p class="service-testimonials__subtitle">{subtitle}</p>
        )}
        <h2 class="service-testimonials__title">{title}</h2>
      </div>
    )}
    
    <div class={`service-testimonials__${layout}`}>
      {layout === 'social' ? (
        testimonials.map((testimonial) => (
          <div class="social-card">
            <div class="social-card__top">
              <div class="social-card__avatar">
                {testimonial.author.image ? (
                  <img
                    src={testimonial.author.image}
                    alt={testimonial.author.name}
                    loading="lazy"
                    decoding="async"
                  />
                ) : (
                  <div class="social-card__avatar-fallback">
                    {testimonial.author.name?.[0]}
                  </div>
                )}
              </div>
              <div class="social-card__meta">
                <div class="social-card__name">{testimonial.author.name}</div>
                {testimonial.author.handle && (
                  <div class="social-card__handle">{testimonial.author.handle}</div>
                )}
              </div>
              <div class="social-card__platform" aria-label={testimonial.platform}>
                {testimonial.platform === 'linkedin' && (
                  <LinkedInIcon classNamed="social-card__platform-icon" />
                )}
                {testimonial.platform === 'x' && (
                  <XIcon classNamed="social-card__platform-icon" />
                )}
              </div>
            </div>
            <blockquote class="social-card__quote">"{testimonial.quote}"</blockquote>
          </div>
        ))
      ) : (
        testimonials.map((testimonial) => (
          <div class="service-testimonials__item">
            {showRatings && testimonial.rating && (
              <div class="service-testimonials__rating">
                <span class="service-testimonials__stars">
                  {generateStars(testimonial.rating)}
                </span>
              </div>
            )}
            <blockquote class="service-testimonials__quote">
              "{testimonial.quote}"
            </blockquote>
            <div class="service-testimonials__author">
              {testimonial.author.image && (
                <div class="service-testimonials__avatar">
                  <img
                    src={testimonial.author.image}
                    alt={testimonial.author.name}
                    loading="lazy"
                    decoding="async"
                  />
                </div>
              )}
              <div class="service-testimonials__author-info">
                <cite class="service-testimonials__author-name">
                  {testimonial.author.name}
                </cite>
                {(testimonial.author.title || testimonial.author.company) && (
                  <p class="service-testimonials__author-title">
                    {testimonial.author.title}
                    {testimonial.author.title && testimonial.author.company && ', '}
                    {testimonial.author.company}
                  </p>
                )}
                {testimonial.project && (
                  <p class="service-testimonials__project">
                    Project: {testimonial.project}
                  </p>
                )}
              </div>
            </div>
          </div>
        ))
      )}
    </div>
  </div>
</section>

<style>
.service-testimonials {
  padding: 4rem 0;
  background: var(--background-color);
}

.service-testimonials__container {
  max-width: var(--container-width);
  margin: 0 auto;
  padding: 0 1rem;
}

.service-testimonials__header {
  text-align: center;
  margin-bottom: 3rem;
}

.service-testimonials__subtitle {
  font-size: var(--text-sm);
  font-weight: 600;
  color: var(--secondary-color);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin: 0 0 0.5rem 0;
}

.service-testimonials__title {
  font-family: var(--serif-font);
  font-size: var(--text-3xl);
  font-weight: 700;
  color: var(--text-color);
  margin: 0;
}

.service-testimonials__grid {
  display: grid;
  gap: 2rem;
  grid-template-columns: 1fr;
}

@media (--medium-up) {
  .service-testimonials__grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (--large-up) {
  .service-testimonials__grid {
    grid-template-columns: repeat(3, 1fr);
  }
}

.service-testimonials__carousel {
  display: flex;
  gap: 2rem;
  overflow-x: auto;
  scroll-snap-type: x mandatory;
  padding-bottom: 1rem;
}

.service-testimonials__carousel .service-testimonials__item {
  min-width: 300px;
  scroll-snap-align: start;
}

@media (--medium-up) {
  .service-testimonials__carousel .service-testimonials__item {
    min-width: 400px;
  }
}

.service-testimonials__single {
  max-width: 40rem;
  margin: 0 auto;
}

.service-testimonials__item {
  padding: 2rem;
  background: var(--background-color);
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius);
  box-shadow: 0 2px 8px var(--shadow-color-alpha);
  transition: var(--global-transition);
  position: relative;
}

.service-testimonials__item:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 24px var(--shadow-color);
  border-color: var(--secondary-color);
}

.service-testimonials__item::before {
  content: '"';
  position: absolute;
  top: -0.5rem;
  left: 1.5rem;
  font-size: 4rem;
  font-family: var(--serif-font);
  color: var(--secondary-color);
  opacity: 0.3;
  line-height: 1;
}

.service-testimonials__rating {
  margin-bottom: 1rem;
}

.service-testimonials__stars {
  font-size: var(--text-lg);
  color: #ffd700;
  letter-spacing: 0.1em;
}

.service-testimonials__quote {
  font-size: var(--text-lg);
  line-height: var(--line-height);
  color: var(--text-color);
  font-style: italic;
  margin: 0 0 1.5rem 0;
  position: relative;
  z-index: 1;
}

.service-testimonials__author {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.service-testimonials__avatar {
  width: 3rem;
  height: 3rem;
  border-radius: 50%;
  overflow: hidden;
  flex-shrink: 0;
  background: var(--border-color);
}

.service-testimonials__avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.service-testimonials__author-info {
  flex: 1;
}

.service-testimonials__author-name {
  display: block;
  font-size: var(--text-base);
  font-weight: 600;
  color: var(--text-color);
  font-style: normal;
  margin: 0 0 0.25rem 0;
}

.service-testimonials__author-title {
  font-size: var(--text-sm);
  color: var(--muted-text-color);
  margin: 0 0 0.25rem 0;
}

.service-testimonials__project {
  font-size: var(--text-xs);
  color: var(--secondary-color);
  font-weight: 500;
  margin: 0;
}

/* Single layout specific styles */
.service-testimonials__single .service-testimonials__item {
  text-align: center;
  padding: 3rem;
}

.service-testimonials__single .service-testimonials__quote {
  font-size: var(--text-xl);
  margin-bottom: 2rem;
}

.service-testimonials__single .service-testimonials__author {
  justify-content: center;
  flex-direction: column;
  gap: 1rem;
}

.service-testimonials__single .service-testimonials__avatar {
  width: 4rem;
  height: 4rem;
}

/* Carousel scrollbar styling */
.service-testimonials__carousel::-webkit-scrollbar {
  height: 8px;
}

.service-testimonials__carousel::-webkit-scrollbar-track {
  background: var(--border-color);
  border-radius: 4px;
}

.service-testimonials__carousel::-webkit-scrollbar-thumb {
  background: var(--secondary-color);
  border-radius: 4px;
}

.service-testimonials__carousel::-webkit-scrollbar-thumb:hover {
  background: var(--primary-color);
}

/* Social layout */
.service-testimonials__social {
  display: grid;
  gap: 1.5rem;
  grid-template-columns: 1fr;
}

@media (--medium-up) {
  .service-testimonials__social {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (--large-up) {
  .service-testimonials__social {
    grid-template-columns: repeat(3, 1fr);
  }
}

.social-card {
  position: relative;
  padding: 1.25rem 1rem 1.5rem 1rem;
  background: var(--background-color);
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius);
  box-shadow: 0 2px 8px var(--shadow-color-alpha);
  transition: var(--global-transition);
}

.social-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 24px var(--shadow-color);
  border-color: var(--secondary-color);
}

.social-card__top {
  display: grid;
  grid-template-columns: 40px 1fr 16px;
  gap: 0.75rem;
  align-items: center;
  margin-bottom: 0.75rem;
}

.social-card__avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  overflow: hidden;
  background: var(--border-color);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  color: var(--text-color);
}

.social-card__avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.social-card__avatar-fallback {
  font-size: 0.9rem;
}

.social-card__meta {
  display: flex;
  flex-direction: column;
}

.social-card__name {
  font-weight: 600;
  color: var(--text-color);
}

.social-card__handle {
  color: var(--muted-text-color);
  font-size: var(--text-sm);
}

.social-card__platform {
  display: flex;
  justify-content: flex-end;
}

.social-card__platform-icon {
  font-size: 16px;
  color: var(--muted-text-color);
}

.social-card__quote {
  color: var(--text-color);
  margin: 0;
  line-height: var(--line-height);
}
</style>