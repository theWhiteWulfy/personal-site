---
import styles from '@styles/resources-page.module.css';

export interface Props {
  resourceName: string;
  formTitle?: string;
  formSubtitle?: string;
  submitText?: string;
}

const { 
  resourceName, 
  formTitle = "Get Your Free Resource",
  formSubtitle = "Fill out the form below to download this resource instantly.",
  submitText = "Download Now"
} = Astro.props;
---

<div class={styles['resource-form-container']}>
  <div class={styles['resource-form-header']}>
    <h3 class={styles['form-title']}>{formTitle}</h3>
    {formSubtitle && <p class={styles['form-subtitle']}>{formSubtitle}</p>}
  </div>

  <form class={styles['resource-form']} id="resourceForm" data-resource={resourceName}>
    <!-- Honeypot fields for bot detection (hidden from users) -->
    <div class={styles['honeypot-fields']} aria-hidden="true">
      <input type="text" name="website" tabindex="-1" autocomplete="off" />
      <input type="url" name="url" tabindex="-1" autocomplete="off" />
      <input type="tel" name="phone_number" tabindex="-1" autocomplete="off" />
      <input type="url" name="company_url" tabindex="-1" autocomplete="off" />
    </div>

    <div class={styles['form-group']}>
      <label for="email" class={styles['form-label']}>
        Email Address <span class={styles['required']}>*</span>
      </label>
      <input 
        type="email" 
        id="email" 
        name="email" 
        class={styles['form-input']}
        required 
        autocomplete="email"
        placeholder="your.email@company.com"
        aria-describedby="email-error"
      />
      <div class={styles['error-message']} id="email-error" role="alert"></div>
    </div>

    <div class={styles['form-group']}>
      <label for="name" class={styles['form-label']}>
        Full Name <span class={styles['required']}>*</span>
      </label>
      <input 
        type="text" 
        id="name" 
        name="name" 
        class={styles['form-input']}
        required 
        autocomplete="name"
        placeholder="John Doe"
        aria-describedby="name-error"
      />
      <div class={styles['error-message']} id="name-error" role="alert"></div>
    </div>

    <div class={styles['form-group']}>
      <label for="workplace" class={styles['form-label']}>
        Company/Organization <span class={styles['required']}>*</span>
      </label>
      <input 
        type="text" 
        id="workplace" 
        name="workplace" 
        class={styles['form-input']}
        required 
        autocomplete="organization"
        placeholder="Acme Corporation"
        aria-describedby="workplace-error"
      />
      <div class={styles['error-message']} id="workplace-error" role="alert"></div>
    </div>

    <div class={styles['form-group']}>
      <label for="role" class={styles['form-label']}>
        Job Title/Role <span class={styles['required']}>*</span>
      </label>
      <input 
        type="text" 
        id="role" 
        name="role" 
        class={styles['form-input']}
        required 
        autocomplete="organization-title"
        placeholder="Marketing Manager"
        aria-describedby="role-error"
      />
      <div class={styles['error-message']} id="role-error" role="alert"></div>
    </div>

    <!-- Hidden field for resource name -->
    <input type="hidden" name="resourceName" value={resourceName} />

    <div class={styles['form-actions']}>
      <button type="submit" class:list={[styles.btn, styles.submit]} id="submitBtn">
        <span class={styles['btn-text']}>{submitText}</span>
        <span class={styles['btn-loading']} style="display: none;">
          <svg class={styles.spinner} width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-dasharray="31.416" stroke-dashoffset="31.416">
              <animate attributeName="stroke-dasharray" dur="2s" values="0 31.416;15.708 15.708;0 31.416" repeatCount="indefinite"/>
              <animate attributeName="stroke-dashoffset" dur="2s" values="0;-15.708;-31.416" repeatCount="indefinite"/>
            </circle>
          </svg>
          Processing...
        </span>
      </button>
    </div>

    <div class={styles['form-messages']}>
      <div class={styles['success-message']} id="successMessage" style="display: none;" role="alert">
        <svg class={styles['success-icon']} width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span class={styles['message-text']}></span>
      </div>
      
      <div class={styles['error-message-global']} id="globalError" style="display: none;" role="alert">
        <svg class={styles['error-icon']} width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span class={styles['message-text']}></span>
      </div>
    </div>

    <div class={styles['form-footer']}>
      <p class={styles['privacy-note']}>
        We respect your privacy. Your information will only be used to send you the requested resource and occasional updates about similar content. You can unsubscribe at any time.
      </p>
    </div>
  </form>
</div>

<script>
  // Import and initialize form validation
  import '@/lib/resource-form.js';
</script>